name: Basic Workflow develop

# trigger
on:
    push:
        branches:
            - main

jobs:
    run-unit-test-job:
        runs-on: ubuntu-latest
        steps:
            - name: Clone Source Code to runner
              uses: actions/checkout@v5

            - name: intall dependencies
              run: npm i

            - name: run unit test
              run: npm run test

    build-docker-image-and-push:
        runs-on: ubuntu-latest
        needs: run-unit-test-job
        steps:
            - name: Clone Source Code to runner
              uses: actions/checkout@v5

            - name: build docker image
              run: docker build -t talel12/api-session13 .

              
            - name: tag docker image with version
              run: docker tag talel12/api-session13 talel12/api-session13:v2
              
            - run: docker images

            - run: echo ${{ vars.DOCKERHUB_USERNAME }}
            - run: echo ${{ secrets.DOCKERHUB_TOKEN }}

            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
                username: ${{ vars.DOCKERHUB_USERNAME }}
                password: ${{ secrets.DOCKERHUB_TOKEN }}

        # - login to docker hub
        # - push docker image

    # 3 deploy to vps
        # - ssh connection to vps
        # - pull docker image
        # - run docker container